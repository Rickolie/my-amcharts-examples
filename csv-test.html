<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>amCharts 5 CSV Example</title>
  <style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }
  </style>
</head>
<body>
  <h1>amCharts 5 - CSV Data Example</h1>
  <div id="chartdiv"></div>

  <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    am5.ready(function() {
      var root = am5.Root.new("chartdiv");

      var chart = root.container.children.push(
        am5xy.XYChart.new(root, {
          panX: true,
          panY: true,
          wheelX: "panX",
          wheelY: "zoomX"
        })
      );

      // Create axes
      var xAxis = chart.xAxes.push(
        am5xy.DateAxis.new(root, {
          maxDeviation: 0.5,
          baseInterval: { timeUnit: "second", count: 1 },
          renderer: am5xy.AxisRendererX.new(root, {}),
          tooltip: am5.Tooltip.new(root, {})
        })
      );

      var yAxis = chart.yAxes.push(
        am5xy.ValueAxis.new(root, {
          renderer: am5xy.AxisRendererY.new(root, {})
        })
      );

      // Create series
      var series = chart.series.push(
        am5xy.LineSeries.new(root, {
          name: "Cabinet Temperature",
          xAxis: xAxis,
          yAxis: yAxis,
          valueYField: "CABINET_TEMPERATURE",
          valueXField: "date",
          tooltip: am5.Tooltip.new(root, {
            labelText: "{valueY}"
          })
        })
      );

      series.strokes.template.setAll({
        strokeWidth: 2
      });

      // Load CSV data
      Papa.parse("csv/data_CorrectedDateTime.csv", {
        download: true,
        header: true,
        dynamicTyping: true,
        complete: function(results) {
          // Convert CSV Date + UTC Time to JS date timestamp
          var data = results.data.map(function(row) {
            // Construct a date string and parse it
            // Input format: Date = "8/3/2025", UTC Time = "12:16.2" (could be "HH:mm.s" format)
            var dateStr = row.Date + " " + row["UTC Time"];
            var parsedDate = parseDateTime(dateStr);
            return {
              date: parsedDate.getTime(),  // amCharts DateAxis expects timestamp
              CABINET_TEMPERATURE: row.CABINET_TEMPERATURE
            };
          });

          series.data.setAll(data);
          xAxis.data.setAll(data);
        }
      });

      // Helper function to parse "MM/DD/YYYY HH:mm.s" (e.g. "8/3/2025 12:16.2")
      function parseDateTime(dateTimeStr) {
        // Split date and time
        var parts = dateTimeStr.split(" ");
        var datePart = parts[0];  // e.g. "8/3/2025"
        var timePart = parts[1];  // e.g. "12:16.2"

        var dateParts = datePart.split("/");
        var month = parseInt(dateParts[0], 10) - 1; // zero-based month
        var day = parseInt(dateParts[1], 10);
        var year = parseInt(dateParts[2], 10);

        // Time can be HH:mm.s (with fractional seconds)
        var timeParts = timePart.split(":");
        var hours = parseInt(timeParts[0], 10);
        var minSec = parseFloat(timeParts[1]);
        var minutes = Math.floor(minSec);
        var seconds = (minSec - minutes) * 60;

        return new Date(year, month, day, hours, minutes, seconds);
      }
    });
  </script>
</body>
</html>
