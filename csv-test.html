<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>amCharts 5 CSV Example</title>
  <style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }
  </style>
</head>
<body>
  <h1>amCharts 5 - CSV Data Example</h1>
  <div id="chartdiv"></div>

  <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    am5.ready(function() {
      var root = am5.Root.new("chartdiv");

      var chart = root.container.children.push(
        am5xy.XYChart.new(root, {
          panX: true,
          panY: true,
          wheelX: "panX",
          wheelY: "zoomX"
        })
      );

      // Axes
      var xAxis = chart.xAxes.push(
        am5xy.DateAxis.new(root, {
          baseInterval: { timeUnit: "second", count: 1 },
          renderer: am5xy.AxisRendererX.new(root, {}),
          tooltip: am5.Tooltip.new(root, {})
        })
      );

      var yAxis = chart.yAxes.push(
        am5xy.ValueAxis.new(root, {
          renderer: am5xy.AxisRendererY.new(root, {})
        })
      );

      // Series
      var series = chart.series.push(
        am5xy.LineSeries.new(root, {
          name: "Cabinet Temperature",
          xAxis: xAxis,
          yAxis: yAxis,
          valueYField: "CABINET_TEMPERATURE",
          valueXField: "date",
          tooltip: am5.Tooltip.new(root, { labelText: "{valueY}" })
        })
      );

      series.strokes.template.setAll({ strokeWidth: 2 });

      // Load CSV
      Papa.parse("csv/data_CorrectedDateTime.csv", {
        download: true,
        header: true,
        dynamicTyping: true,
        complete: function(results) {
          var data = results.data
            .map(function(row) {
              if (!row.datetime) return null;
              var cleanTime = String(row.datetime).trim();
              var ts = Date.parse(cleanTime); // parse ISO 8601
              if (isNaN(ts)) {
                console.warn("Invalid date:", cleanTime);
                return null;
              }
              return {
                date: ts,
                CABINET_TEMPERATURE: Number(row.CABINET_TEMPERATURE)
              };
            })
            .filter(item => item !== null);

          console.log("Parsed data:", data); // Debug output

          if (data.length > 0) {
            series.data.setAll(data);
          } else {
            console.error("No valid data found in CSV");
          }
        }
      });
    });
  </script>
</body>
</html>

