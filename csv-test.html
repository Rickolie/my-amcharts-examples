<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <meta charset="UTF-8" />
  <title>CSV Example</title>
  <style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }
  </style>
</head>
<body>
  <div id="chartdiv"></div>

  <script>
  am5.ready(function() {
    var root = am5.Root.new("chartdiv");
    root.setThemes([ am5themes_Animated.new(root) ]);

    var chart = root.container.children.push(am5xy.XYChart.new(root, {
      panX: true,
      panY: true,
      wheelX: "panX",
      wheelY: "zoomX"
    }));

    var xAxis = chart.xAxes.push(am5xy.DateAxis.new(root, {
      maxDeviation: 0.2,
      groupData: false,
      baseInterval: { timeUnit: "millisecond", count: 2 }, // finer but not 1ms
      renderer: am5xy.AxisRendererX.new(root, {}),
      tooltip: am5.Tooltip.new(root, {})
    }));

    var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
      renderer: am5xy.AxisRendererY.new(root, {})
    }));

    var series = chart.series.push(am5xy.LineSeries.new(root, {
      name: "Cabinet Temp",
      xAxis: xAxis,
      yAxis: yAxis,
      valueYField: "CABINET_TEMPERATURE",
      valueXField: "datetime",
      tooltip: am5.Tooltip.new(root, { labelText: "{valueY}" })
    }));

    Papa.parse("csv/data.csv", {
      download: true,
      header: true,
      dynamicTyping: true,
      complete: function(results) {
        let parsed = results.data
          .filter(row => row.datetime) // remove empty rows
          .map(row => ({
            ...row,
            datetime: Date.parse(row.datetime) // safer parsing
          }))
          .filter(row => !isNaN(row.datetime)); // keep only valid dates

        series.data.setAll(parsed);
      }
    });

    series.appear(1000);
    chart.appear(1000, 100);
  });
  </script>
</body>
</html>

